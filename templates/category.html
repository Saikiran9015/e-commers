<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{{ category }} – Claufe.</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

<!-- Slide sidebar (overlay) + snitch-style navbar (copied from landing) -->
<div class="slide-sidebar" id="slideSidebar" aria-hidden="true">
  <div class="sidebar-header">
    CATEGORIES
    <span class="close-btn" onclick="toggleMenu()">✕</span>
  </div>

  <a href="{{ url_for('category_view', category='BESTSELLERS') }}" class="category {{ 'active' if category and category|lower == 'bestsellers' else '' }}">BESTSELLERS</a>
  <a href="{{ url_for('category_view', category='NEW') }}" class="category {{ 'active' if category and category|lower == 'new' else '' }}">NEW</a>
  <a href="{{ url_for('category_view', category='SHIRTS') }}" class="category {{ 'active' if category and category|lower == 'shirts' else '' }}">SHIRTS</a>
  <a href="{{ url_for('category_view', category='JACKETS') }}" class="category {{ 'active' if category and category|lower == 'jackets' else '' }}">JACKETS</a>
  <a href="{{ url_for('category_view', category='JEANS') }}" class="category {{ 'active' if category and category|lower == 'jeans' else '' }}">JEANS</a>
  <a href="{{ url_for('category_view', category='SWEATERS') }}" class="category {{ 'active' if category and category|lower == 'sweaters' else '' }}">SWEATERS</a>
  <a href="{{ url_for('category_view', category='T-SHIRTS') }}" class="category {{ 'active' if category and category|lower == 't-shirts' else '' }}">T-SHIRTS</a>
  <a href="{{ url_for('category_view', category='HOODIES & SWEATSHIRTS') }}" class="category {{ 'active' if category and category|lower == 'hoodies & sweatshirts' else '' }}">HOODIES &amp; SWEATSHIRTS</a>
</div>

<div class="slide-overlay" id="slideOverlay" onclick="toggleMenu()" aria-hidden="true"></div>

<header class="snitch-navbar">
  <div class="snitch-menu-icon" onclick="toggleMenu()">☰</div>
  <div class="snitch-logo"><a href="{{ url_for('landing') }}"><img src="{{ url_for('static', filename='4.png') }}" class="logo-img" alt="Logo"><span class="site-name"></span></a></div>

  <div class="snitch-nav-right">
    <div class="snitch-search">
      <input id="searchInput" type="text" placeholder="Search 'Jackets'">
    </div>
    <div class="snitch-icons">
      {% if session.get('email') %}
        <a href="{{ url_for('logout') }}" title="Account">Logout</a>
      {% else %}
        <a href="{{ url_for('login') }}" title="Login">Login</a>
      {% endif %}
      <a href="{{ url_for('landing') }}" title="Cart">Home</a>
      <a href="{{ url_for('cart') }}" title="Cart">Cart</a>
    </div>
  </div>
</header>

<section class="category-page">
  <div class="category-header">
    <div>
      <div class="category-title">{{ category }}</div>
      <div class="category-sub">Products in '{{ category }}' category — {{ products|length }} item{{ 's' if products|length != 1 else '' }}</div>
    </div>

    <div>
      <a href="{{ url_for('landing') }}" class="btn btn-outline">All Products</a>
    </div>
  </div>

  <section class="category-grid">
    {% for p in products %}
    <article class="category-card {{ 'horizontal' if loop.index0 % 2 == 0 else '' }}">
        <a href="{{ url_for('product_page', product_id=p['_id']) }}">
            {% if p['image_filename'] %}
            <img src="{{ p['image_filename'] if 'data:' in p['image_filename'] else url_for('uploaded_file', filename=p['image_filename']) }}" alt="{{ p['name'] }}">
            {% else %}
            <img src="https://via.placeholder.com/800x600?text=No+Image" alt="No Image">
            {% endif %}
        </a>

        <div class="product-body">
            <div class="product-name">{{ p['name'] }}</div>
            <div class="product-price">₹{{ p['price'] }}</div>
            <div class="small-muted">{{ p.get('description','')|truncate(120) }}</div>

            <div style="margin-top:12px;display:flex;gap:10px;">
              <a href="{{ url_for('product_page', product_id=p['_id']) }}" class="btn btn-primary">View</a>
              <form action="{{ url_for('add_to_cart', product_id=p['_id']) }}" method="POST" style="margin:0;">
                <button type="submit" class="btn btn-outline">Add to Cart</button>
              </form>
            </div>
        </div>
    </article>
    {% else %}
    <p style="grid-column:1/-1;text-align:center;">No products in this category.</p>
    {% endfor %}
  </section>
</section>

  <script>
  function toggleMenu() {
    const sb = document.getElementById('slideSidebar');
    const so = document.getElementById('slideOverlay');
    if (!sb || !so) return;
    sb.classList.toggle('active');
    so.classList.toggle('active');
  }
  </script>

  <script>
  // Keep header behavior consistent: Enter in search navigates to category view
  (function(){
    const input = document.getElementById('searchInput');
    if (!input) return;

    input.addEventListener('keydown', function(e){
      if (e.key === 'Enter'){
        const q = e.target.value.trim();
        if (!q) return;
        window.location.href = '/category/' + encodeURIComponent(q);
      }
    });
  })();
  </script>

  </body>
  </html>
